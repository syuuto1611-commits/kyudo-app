<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>å¼“é“å ´äºˆç´„ï¼ˆè¨ºæ–­ï¼‰</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fff0f5; text-align: center; }
    h2 { color: #d63384; }
    .box { background: white; padding: 15px; border-radius: 8px; border: 2px solid #333; margin-bottom: 20px; word-break: break-all; }
    .error { color: red; font-weight: bold; }
    .ok { color: green; font-weight: bold; }
    button { background: #333; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; margin-top: 10px;}
  </style>
</head>
<body>
  <h2>ğŸ” è¨­å®šè¨ºæ–­ãƒ¢ãƒ¼ãƒ‰</h2>
  
  <div id="check-result" class="box">
    è¨ºæ–­ä¸­...
  </div>

  <div id="console" class="box" style="text-align:left; font-size:12px; background:#eee;">
    ãƒ­ã‚°:<br>
  </div>

  <script>
    // â–¼â–¼â–¼ ã“ã“ã«GASã®URLã‚’è²¼ã£ã¦ãã ã•ã„ â–¼â–¼â–¼
    // â€»ã€Œ'ã€ã¨ã€Œ'ã€ã®é–“ã«è²¼ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ï¼
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbzkmoy7CDtPUzKkVqFiFkHt28Y8gWhZvHvn8Oddpy1tJIOzRWPw14KQDsNAXMqwfBCH/exec'; 
    const LIFF_ID = '2008892711-dVDOw8oH';
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    function log(msg) {
      document.getElementById('console').innerHTML += msg + "<br>";
    }

    async function startCheck() {
      const resBox = document.getElementById('check-result');
      log("è¨ºæ–­ã‚’é–‹å§‹ã—ã¾ã™...");
      log("è¨­å®šã•ã‚ŒãŸURL: " + GAS_URL);

      // 1. URLã®å½¢å¼ãƒã‚§ãƒƒã‚¯
      if (GAS_URL.includes("xxxxxxxx")) {
        resBox.innerHTML = "<span class='error'>âŒ URLãŒæ›¸ãæ›ã‚ã£ã¦ã„ã¾ã›ã‚“ï¼</span><br>ã‚³ãƒ¼ãƒ‰ã®39è¡Œç›®ãŒ xxxx ã®ã¾ã¾ã§ã™ã€‚";
        return;
      }
      if (!GAS_URL.startsWith("https://script.google.com/")) {
        resBox.innerHTML = "<span class='error'>âŒ GASã®URLã§ã¯ã‚ã‚Šã¾ã›ã‚“</span><br>https://script.google.com/... ã§å§‹ã¾ã‚‹æ­£ã—ã„URLã§ã™ã‹ï¼Ÿ";
        return;
      }
      if (GAS_URL.includes("/edit")) {
        resBox.innerHTML = "<span class='error'>âŒ ç·¨é›†ç”»é¢ã®URLã§ã™</span><br>ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã€ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚";
        return;
      }
      if (GAS_URL.endsWith("/dev")) {
        resBox.innerHTML = "<span class='error'>âŒ ãƒ†ã‚¹ãƒˆç”¨URL(/dev)ã§ã™</span><br>æœ«å°¾ãŒ /exec ã§çµ‚ã‚ã‚‹URLã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚";
        return;
      }

      // 2. LIFFæ¥ç¶šãƒã‚§ãƒƒã‚¯
      try {
        log("LIFFåˆæœŸåŒ–ä¸­...");
        await liff.init({ liffId: LIFF_ID });
        log("LIFF OK (ID: " + liff.id + ")");
      } catch (e) {
        resBox.innerHTML = "<span class='error'>âŒ LIFFåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</span><br>" + e.message;
        return;
      }

      // 3. GASé€šä¿¡ãƒ†ã‚¹ãƒˆ
      log("GASã¸é€šä¿¡ãƒ†ã‚¹ãƒˆä¸­...");
      try {
        // ã‚·ãƒ³ãƒ—ãƒ«ãªæ¥ç¶šãƒ†ã‚¹ãƒˆ
        const response = await fetch(GAS_URL + "?action=checkUser&userId=test");
        
        if (!response.ok) {
           throw new Error("HTTP Status: " + response.status);
        }
        
        const text = await response.text();
        log("å—ä¿¡ãƒ‡ãƒ¼ã‚¿: " + text.substring(0, 50) + "...");

        try {
          const json = JSON.parse(text);
          if (json.error) {
             resBox.innerHTML = "<span class='error'>âš ï¸ GASå´ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</span><br>" + json.error;
          } else {
             resBox.innerHTML = "<span class='ok'>âœ… æˆåŠŸï¼æ¥ç¶šã§ãã¾ã—ãŸï¼</span><br>è¨­å®šã¯å®Œç’§ã§ã™ã€‚<br>ã‚³ãƒ¼ãƒ‰ã‚’æœ¬ç•ªç”¨ã«æˆ»ã—ã¦ãã ã•ã„ã€‚";
          }
        } catch (e) {
           // HTMLãŒè¿”ã£ã¦ãã¦ã„ã‚‹ï¼ˆï¼Googleã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒå‡ºã¦ã„ã‚‹ï¼‰
           if (text.includes("Google")) {
             resBox.innerHTML = "<span class='error'>âŒ æ¨©é™ã‚¨ãƒ©ãƒ¼</span><br>GASã®å…¬é–‹ç¯„å›²ãŒã€Œè‡ªåˆ†ã®ã¿ã€ã«ãªã£ã¦ã„ã¾ã™ã€‚<br>ã€Œå…¨å“¡ (Anyone)ã€ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚";
           } else {
             resBox.innerHTML = "<span class='error'>âš ï¸ è¬ã®ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡</span><br>JSONã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>" + text.substring(0, 100);
           }
        }

      } catch (e) {
        log("é€šä¿¡å¤±æ•—: " + e.message);
        resBox.innerHTML = "<span class='error'>âŒ é€šä¿¡å¤±æ•— (Load failed)</span><br>è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :<br>ãƒ»URLã®è²¼ã‚Šé–“é•ã„<br>ãƒ»GASã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã—ã¦ã„ãªã„<br>ãƒ»URLã«ä½™è¨ˆãªç©ºç™½ãŒå…¥ã£ã¦ã„ã‚‹";
      }
    }

    window.onload = startCheck;
  </script>
</body>
</html>
